# ./Taskfile.yaml
# See: https://taskfile.dev/api/  

version: "3"  

tasks:  
  default:
    cmds:  
      - task: auth  
  auth:
    desc: "Start auth service"
    cmds:
      - go run ./cmd/auth --config=./config/dev.yaml

  test:
    desc: "Run tests"
    deps:
      - go-test
      - auth-test
  go-test:    
    cmds: 
      - go test ./tests
  auth-test:
    cmds:
      - timeout 5s go run ./cmd/auth --config=./config/tests.yaml

  init_db:
    aliases:
      - db
    desc: "Initialize database"  
    cmds:
      - go run ./cmd/migrator --storage-path=./storage/auth.db --migrations-path=./migrations      
  admins:
    desc: "Add admins to database"  
    cmds:
      - go run ./cmd/admins --storage=./storage/auth.db --admins=./config/admins.yaml